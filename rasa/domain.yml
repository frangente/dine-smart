# Copyright 2024 Francesco Gentile.
# SPDX-License-Identifier: Apache-2.0

version: "3.1"

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# INTENTS
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

intents:
- greet
- goodbye
- affirm
- deny
- continue
- stop
- bot_challenge
- help
- inform_location
- inform_my_location
- delete
- select
- out_of_scope

- show_search_history
- clear_search_history
- select_searches
- delete_searches
- show_search_parameters
- show_search_results

- search_place_to_eat_now
- search_place_to_drink_now
- search_place_now
- search_place_to_eat
- search_place_to_drink
- search_place
- inform_search
- inform_price_range_any
- inform_price_range_expensive
- inform_price_range_moderate
- inform_price_range_inexpensive
- inform_quality_any
- inform_quality_excellent
- inform_quality_moderate
- inform_price_range_any+inform_quality_any
- inform_price_range_any+inform_quality_excellent
- inform_price_range_any+inform_quality_moderate
- inform_price_range_expensive+inform_quality_excellent
- inform_price_range_moderate+inform_quality_any
- inform_price_range_moderate+inform_quality_excellent
- inform_price_range_moderate+inform_quality_moderate
- inform_price_range_inexpensive+inform_quality_any
- inform_price_range_inexpensive+inform_quality_excellent
- inform_price_range_inexpensive+inform_quality_moderate
- rank_results_by_relevance
- rank_results_by_distance
- rank_results_by_unsupported

- ask_address
- ask_contact
- ask_price_level
- ask_rating
- ask_website
- ask_allows_animals
- ask_good_for_children
- ask_parking_options
- ask_payment_options
- ask_outdoor_seating
- ask_reservable
- ask_restroom
- ask_vegetarian
- ask_takeout
- ask_previous_info

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# ENTITIES
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

entities:
- user_name
- location
- mention
- place_name
- place_type
- cuisine_type
- meal_type

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# SLOTS
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

slots:
  num_internal_errors:
    type: float
    initial_value: 0
    min_value: 0
    max_value: 3
    influence_conversation: false
    mappings:
    - type: custom
  
  known_user:
    type: bool
    influence_conversation: false
    initial_value: false
    mappings:
    - type: custom
  
  user_name:
    type: text
    influence_conversation: false
    initial_value: "\b"
    mappings:
    - type: from_entity
      entity: user_name
  
  user_location:
    type: any
    influence_conversation: false
    mappings:
    - type: custom
  
  # ------------------------------------------------------------------------- #
  # SEARCH-HISTORY RELATED SLOTS
  # ------------------------------------------------------------------------- #

  search_history:
    type: list
    influence_conversation: true
    initial_value: []
    mappings:
    - type: custom
  
  selected_searches:
    type: addons.slots.EmptySingleMultipleList
    influence_conversation: true
    mappings:
    - type: custom
  
  selected_searches_error:
    type: categorical
    values:
    - not_specified
    - wrong_indices
    influence_conversation: true
    mappings:
    - type: custom
  
  # ------------------------------------------------------------------------- #
  # SEARCH SLOTS
  # ------------------------------------------------------------------------- #

  all_required_parameters_set:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

  search_key:
    type: text
    influence_conversation: false
    mappings:
    - type: custom
      action: action_set_search_key
      conditions:
      - active_loop: search_form

  invalid_location:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  invalid_location_reasons:
    type: list
    influence_conversation: false
    mappings:
    - type: custom

  invalid_place_type:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom

  selected_results:
    type: list
    influence_conversation: false
    mappings:
    - type: custom

  selected_results_error:
    type: categorical
    values:
    - wrong_indices
    - no_results
    influence_conversation: true
    mappings:
    - type: custom

  # ------------------------------------------------------------------------- #
  # BOOKING-HISTORY SLOTS
  # ------------------------------------------------------------------------- #

  booking_history:
    type: list
    influence_conversation: true
    mappings:
    - type: custom
  
  selected_booking:
    type: float
    influence_conversation: false
    mappings:
    - type: custom

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# FORMS
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

forms:
  search_form:
    required_slots:
    - search_key

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# ACTIONS
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

actions:
- action_greet
- action_out_of_scope
- action_session_start
- action_restart

- action_search_history_guard
- action_selected_searches_guard

- action_set_search_key
- action_ask_search_key
- action_check_search_parameters
- action_show_search_parameters
- action_search
- action_rank_results
- action_set_selected_results
- action_show_selected_results

- action_show_search_history
- action_clear_search_history
- action_start_search
- action_show_selected_searches
- action_ask_search_deletion
- action_delete_searches
- action_set_selected_searches

- action_retrieve_place_info


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# RESPONSES
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

responses:

  # ------------------------------------------------------------------------- #
  # ERROR HANDLING
  # ------------------------------------------------------------------------- #

  utter_out_of_scope:
  - text: "Sorry, but I cannot help you with that. I can only search for places to eat or drink and make bookings."
  - text: "Sorry, but I cannot help you with this query. I can only search for places to eat or drink and make bookings."
  - text: "I am sorry, but I can only help you with finding places to eat or drink and making bookings."

  utter_out_of_scope_gemini:
  - text: |
      Sorry, but I can only help you with finding places to eat or drink and making bookings. 
      Still, to help you with that, I have forwarded your request to Google Gemini. 
      Here is the response I got: {content}.

  utter_ask_rephrase:
  - text: "I'm sorry, I didn't understand that. Could you please rephrase it?"
  - text: "Sorry, I didn't get that. Could you please rephrase it?"
  - text: "I am sorry, but I didn't catch that. Could you please rephrase it?"

  utter_default:
  - text: "I'm sorry, it seems that I am not able to help you with that."
  - text: "Sorry, I am not able to help you with that."
  - text: "I am so sorry, but I am not able to help you with that."

  utter_internal_error:
  - text: "I'm sorry, I'm having trouble processing your request."
  - text: "Sorry, I'm having some unexpected issues."
  - text: "I am having some issues due to which I am unable to process your request."
  - text: "Sorry but I am facing some issues."

  utter_internal_error_max:
  - text: "I'm sorry but it seems that something is broken. I am resetting the conversation and reporting the issue. Sorry for the inconvenience."
  - text: "I'm still having trouble processing your request. Let's see whether starting from a clean slate helps. Sorry for the inconvenience."
  - text: "Unfortunately, I am still facing issues. I am resetting the conversation and reporting the issue. Sorry for the inconvenience."

  # ------------------------------------------------------------------------- #
  # HELP
  # ------------------------------------------------------------------------- #

  utter_ask_help:
  - text: "Sure, how can I help you?"
  - text: "What can I do for you?"
  - text: "How can I assist you?"

  utter_ask_further_help:
  - text: "Okay, is there anything else I can help you with?"
  - text: "Can I at least help you with anything else?"
  - text: "Perhaps, do you need help with anything else?"
  - text: "Well, is there anything else I can assist you with?"

  # ------------------------------------------------------------------------- #
  # GREETINGS AND FAREWELLS
  # ------------------------------------------------------------------------- #

  utter_first_greet:
  - text: "Hi {user_name}! This is Dine-Smart, your personal assistant to assist you in all your dining needs. How can I help you today?"
  - text: "Hello {user_name}! Welcome to Dine-Smart, your personal assistant for all your dining needs. What can I do for you today?"

  utter_greet:
  - text: "Hi {user_name}! How can I help you today?"
  - text: "Hi {user_name}! Happy to see you again. How can I help you today?"
  - text: "Hello {user_name}! What can I do for you today?"

  utter_goodbye:
  - text: "Goodbye {user_name}! Have a great day."
  - text: "Goodbye {user_name}! Have a nice day. Hope to see you soon."
  - text: "Bye {user_name}! I hope I was able to help you. Have a great day."

  utter_goodbye_no_help:
  - text: "Okay, but if you need help in the future, just ask. Goodbye!"
  - text: "Okay, but if you need help in the future, don't hesitate to ask. Goodbye!"
  - text: "Okay, but if you need help in the future, just let me know. Goodbye!"

  utter_introduction:
  - text: "I am Dine-Smart, your digital assistant here to help you with all your dining needs."

  # ------------------------------------------------------------------------- #
  # SEARCH HISTORY
  # ------------------------------------------------------------------------- #

  utter_empty_search_history_show:
  - text: "Sorry, but you haven't done any searches yet."
  - text: "I am sorry, but you haven't searched for anything yet."
  - text: "Sorry but you don't have any searches yet."
  - text: "I am sorry, but your search history is empty."

  utter_empty_search_history_delete:
  - text: "I am sorry, but you don't have any searches to delete."
  - text: "Your search history is empty so there is nothing to delete."
  - text: "Sorry, but I couldn't find any searches to delete."

  utter_confirm_clear_search_history:
  - text: "Are you sure you want to clear your search history? This action cannot be undone."
  - text: "Are you sure you want to delete all your searches? You won't be able to recover them."
  - text: "Are you sure you want to remove all your searches? This action is irreversible."

  utter_cancel_clear_search_history:
  - text: "Okay, I won't delete your searches."
  - text: "Okay, your searches are safe."
  - text: "Okay, no searches will be deleted."

  utter_cleared_search_history:
  - text: "Your search history has been successfully cleared."
  - text: "All your searches have been deleted."
  - text: "Okay, I have removed all your searches."
  - text: "Okay, your search activity is now empty."

  utter_ask_which_search_to_select:
  - text: "Which search would you like to select?"
  - text: "Which search do you want to select?"
  - text: "Which search should I select for you?"

  utter_ask_which_searches_to_select:
  - text: "Which searches would you like to select?"
  - text: "Which searches do you want to select?"
  - text: "Which searches should I select for you?"

  utter_ask_which_searches_to_select_2:
  - text: "Could you please specify again which searches you want to select?"
  - text: "Could you tell me again which searches you want to select?"

  utter_ask_which_searches_to_delete:
  - text: "Which searches would you like to delete?"
  - text: "Which searches do you want to delete?"
  - text: "Which searches should I delete for you?"

  utter_ask_which_searches_to_delete_2:
  - text: "Could you please specify again which searches you want to delete?"
  - text: "Could you tell me again which searches you want to delete?"

  utter_deleted_searches:
  - text: "Okay, I have removed the selected searches."
  - text: "As you command, the selected searches have been deleted."
  - text: "It's done! The selected searches have been deleted."

  utter_cancel_search_deletion:
  - text: "Okay, I won't delete the selected searches."
  - text: "Okay, the selected searches are safe."
  - text: "Okay, no searches will be deleted."

  # ------------------------------------------------------------------------- #
  # SEARCH
  # ------------------------------------------------------------------------- #

  utter_ask_start_search:
  - text: "Would you like to start a new search?"
  - text: "Do you want to start a new search now?"
  - text: "Shall we start a new search?"

  utter_no_search_selected:
  - text: "Sorry there is no active search. Please select one or start a new search before proceeding."
  - text: "I can't proceed without knowing which search you are referring to. Please select one from your activity."

  utter_multiple_searches_selected:
  - text: "Sorry, but you have multiple selected searches so I can't proceed. Please select one to continue."
  - text: "I don't know which search you are referring to. Please select one from your activity."

  utter_started_search:
  - text: "Okay, starting a new search."
  - text: "Okay, I will start a new search."

  # place_type
  utter_ask_place_type:
  - text: "What type of place are you looking for? A restaurant, bar, pub, or something else?"
  - text: "Where would you like to go? A restaurant, bar, pub, or something else?"
  - text: "Would you like to go to a restaurant, bar, pub, or something else?"

  utter_invalid_place_type:
  - text: "Sorry, but I can only search for places that serve food or drinks, like restaurants, bars or pubs."

  # location
  utter_ask_user_location:
  - text: "Where are you right now?"
  - text: "Could you tell me your current location so that I can find nearby {place_type}?"
  - text: "Okay, could you tell me where you are so that I can find nearby {place_type}?"

  utter_ask_user_location_2:
  - text: "Sorry, but I need to know your location to proceed."
  - text: "Sorry to insist, but I need to know your location to proceed."
  - text: "I can't proceed without knowing your location. Could you tell me where you are?"

  utter_need_user_location:
  - text: "Sorry, but I don't know your location. Could you tell me where you are?"
  - text: "I need to know your location to find places nearby. Could you tell me where you are?"
  - text: "I can't find places nearby without knowing your location. Could you tell me where you are?"

  utter_ask_location:
  - text: "Where would you like to search for {place_type}?"
  - text: "Where should I look for {place_type}?"
  - text: "Where do you want me to search for {place_type}?" 

  utter_ask_location_2:
  - text: "Sorry to insist, but I need to know the search location to proceed."
  - text: "I can't proceed without knowing the search location. Could you tell me where you want to search?"
  - text: "I don't want to be annoying, but I need to know the search location to proceed."

  utter_ask_location_place_name:
  - text: "Where is the {place_name} located?"
  - text: "Where should I look for the {place_name}?"
  - text: "Could you tell me where the {place_name} is located?"

  utter_ask_location_place_name_2:
  - text: "Sorry to insist, but I need to know the location of the {place_name} to proceed."
  - text: "I can't proceed without knowing the location of the {place_name}. Could you tell me where it is located?"
  - text: "I don't want to be annoying, but I need to know the location of the {place_name} to proceed."

  utter_location_not_found:
  - text: "Sorry, but I couldn't find any results for {location}. Could you try again?"
  - text: "Sorry, but I didn't find any matches for {location}. Could you try again?"

  utter_ambiguous_location:
  - text: "Sorry, but I found multiple results for {location}. Could you be more specific?"
  - text: "Sorry, but I wasn't able to precisely locate {location}. Could you provide more details?"

  utter_inform_how_stop_search:
  - text: "If you don't want to keep searching, just say 'stop'."
  - text: "If you want to stop searching, just say 'stop'."
  - text: "If you no longer intend to search, just say 'stop'."

  # rank
  utter_changed_rank_by:
  - text: "Perfect, from now on I will order the results by {rank_by}."
  - text: "Great, I will order the results by {rank_by} from now on."
  - text: "Got it, until you change it, I will order the results by {rank_by}."

  utter_already_ranked_by:
  - text: "The results were already ordered by {rank_by}."
  - text: "The results are already ordered by {rank_by}."
  - text: "The results are already sorted by {rank_by}."

  utter_unsupported_rank_by:
  - text: "Sorry, I can only order the results by relevance or distance. Please choose one of these options."
  - text: "I am sorry but I can only order the results based on relevance or distance."

  utter_ask_stop_search:
  - text: "Are you sure you want to stop the search?"
  - text: "Do you really want to stop the search?"
  - text: "Are you sure you want to end the search?"

  utter_search_stopped:
  - text: "Okay, I have stopped the search."
  - text: "Okay, the current search has been stopped."
  - text: "Okay, the current search has been suspended."

  utter_ask_what_to_change:
  - text: "Now you can tell me what you want to change."
  - text: "Could you remind me what you want to change?"

  # ------------------------------------------------------------------------- #
  # SEARCH RESULTS
  # ------------------------------------------------------------------------- #

  utter_ask_which_results_to_show_2:
  - text: "Could you please specify again which results you want me to show?"
  - text: "Could you tell me again which places you would like to select?"

  utter_missing_search_parameters:
  - text: "Sorry, but not all the required parameters for this search have been set. Would you like to provide them now?"
  - text: "Sorry, but I can't proceed with the search because some required parameters are missing. Would you like to provide them now?"

  utter_no_results:
  - text: "Sorry, but this search didn't return any results. Try changing the search parameters."
  - text: "Sorry, but there are no results for this search. Maybe youcould try changing the search parameters."
  
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# SESSION CONFIGURATION
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true