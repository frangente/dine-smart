version: "3.1"

stories:

- story: inform the user that there is no search history when the user asks
  steps:
  - intent: show_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: []
  - action: utter_empty_search_history_show
  - action: utter_ask_start_search

- story: show the search history when the user asks
  steps:
  - intent: show_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_show_search_history

# --------------------------------------------------------------------------- #
# CLEAR HISTORY
# --------------------------------------------------------------------------- #

- story: the user wants to clear their search history but there is no search history
  steps:
  - intent: clear_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: []
  - action: utter_empty_search_history_delete

- story: the user wants to clear their search history but then they change their mind
  steps:
  - intent: clear_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: utter_confirm_clear_search_history
  - or:
    - intent: deny
    - intent: stop
  - action: utter_cancel_clear_search_history
  - action: utter_ask_further_help

- story: the user wants to clear their search history and they confirm
  steps:
  - intent: clear_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: utter_confirm_clear_search_history
  - intent: affirm
  - action: action_clear_search_history
  - action: utter_cleared_search_history
  - action: utter_ask_further_help

# --------------------------------------------------------------------------- #
# SELECT
# --------------------------------------------------------------------------- #

- story: the user wants to select some searches but there are none
  steps:
  - intent: select_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: []
  - action: utter_empty_search_history_show

- story: the user wants to select some searches but they do not specify any
  steps:
  - intent: select_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: not_specified
  - action: utter_ask_which_searches_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
  - action: action_show_selected_searches

- story: the user wants to select some searches but they specify the wrong indices
  steps:
  - intent: select_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: wrong_indices
  - action: utter_ask_which_searches_to_select_2
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
  - action: action_show_selected_searches

- story: the user first look at the search history and then select some searches
  steps:
  - intent: show_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_show_search_history
  - intent: select
  - action: action_set_selected_searches

# --------------------------------------------------------------------------- #
# DELETE
# --------------------------------------------------------------------------- #

- story: the user wants to delete some searches but there are none
  steps:
  - intent: delete_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: []
  - action: utter_empty_search_history_delete

- story: the user wants to delete some searches but they do not specify any
  steps:
  - intent: delete_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: not_specified
  - action: utter_ask_which_searches_to_delete
  - or:
    - intent: delete_searches
    - intent: delete
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
  - action: action_ask_search_deletion
  - intent: affirm
  - action: action_delete_searches
  - action: utter_deleted_searches
  - action: utter_ask_further_help

- story: the user wants to delete some searches but they provide the wrong indices
  steps:
  - intent: delete_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: wrong_indices
  - action: utter_ask_which_searches_to_delete_2
  - or:
    - intent: delete_searches
    - intent: delete
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
  - action: action_ask_search_deletion
  - intent: affirm
  - action: action_delete_searches
  - action: utter_deleted_searches
  - action: utter_ask_further_help

- story: the user wants to delete some searches but then they change their mind
  steps:
  - intent: delete_searches
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
  - action: action_ask_search_deletion
  - or:
    - intent: deny
    - intent: stop 
  - action: utter_cancel_search_deletion

- story: the user first look at the search history and then tries to delete some searches
  steps:
  - intent: show_search_history
  - action: action_search_history_guard
  - slot_was_set:
    - search_history: ["", ""]
  - action: action_show_search_history
  - intent: delete
  - action: utter_ask_which_searches_to_delete

