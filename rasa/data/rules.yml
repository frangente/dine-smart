version: "3.1"

rules:

# --------------------------------------------------------------------------- #
# GENERAL RULES
# --------------------------------------------------------------------------- #

- rule: say hello anytime the user greets
  steps:
  - intent: greet
  - action: action_greet

- rule: say goodbye anytime the user says goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye
  - action: action_session_start

- rule: states who the bot is when the user asks
  steps:
  - intent: bot_challenge
  - action: utter_introduction

# --------------------------------------------------------------------------- #
# SEARCH-HISTORY RULES
# --------------------------------------------------------------------------- #

- rule: show the search history when the user asks
  steps:
  - intent: show_search_history
  - action: action_show_search_history

- rule: clear the search history when the user asks
  steps:
  - intent: clear_search_history
  - action: action_clear_search_history

# --------------------------------------------------------------------------- #
# SEARCH RULES
# --------------------------------------------------------------------------- #

- rule: start search anytime the user asks for a place to eat or drink
  steps:
  - or:
    - intent: search_place_to_eat_now
    - intent: search_place_to_drink_now
    - intent: search_place_now
    - intent: search_place_to_eat
    - intent: search_place_to_drink
    - intent: search_place
  - action: action_start_search
  - action: search_form
  - active_loop: search_form

- rule: start search anytime the user wants to search
  steps:
  - action: utter_ask_start_search
  - intent: affirm
  - action: action_start_search
  - action: search_form
  - active_loop: search_form

- rule: search when all slots are filled
  condition:
  - active_loop: search_form
  steps:
  - action: search_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_search

- rule: the user provides further information for the active search
  condition:
  - active_loop: null
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_check_number_selected_searches
  - slot_was_set:
    - number_selected_searches: single
  - action: search_form
  - active_loop: search_form

- rule: the user provides further information but there is no active search
  condition:
  - active_loop: null
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_check_number_selected_searches
  - slot_was_set:
    - number_selected_searches: none
  - action: utter_no_active_search

- rule: the user provides further information but there are multiple active searches
  condition:
  - active_loop: null
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_check_number_selected_searches
  - slot_was_set:
    - number_selected_searches: multiple
  - action: utter_multiple_active_searches

