version: "3.1"

rules:

- rule: do not start search if the user does not want to
  steps:
  - action: utter_ask_start_search
  - or:
    - intent: deny
    - intent: stop
  - action: utter_ask_further_help

- rule: start search anytime the user wants to search
  steps:
  - action: utter_ask_start_search
  - intent: affirm
  - action: action_start_search
  - action: search_form
  - active_loop: search_form

- rule: start search anytime the user asks for a place to eat or drink
  steps:
  - or:
    - intent: search_place_to_eat_now
    - intent: search_place_to_drink_now
    - intent: search_place_now
    - intent: search_place_to_eat
    - intent: search_place_to_drink
    - intent: search_place
  - action: action_start_search
  - action: search_form
  - active_loop: search_form

- rule: search when all slots are filled
  condition:
  - active_loop: search_form
  steps:
  - action: search_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_search

- rule: the user wants to rank results by a metric not supported
  steps:
  - intent: rank_results_by_unsupported
  - action: utter_unsupported_rank_by