version: "3.1"

stories:

# --------------------------------------------------------------------------- #
# SEARCH FORM
# --------------------------------------------------------------------------- #

- story: the user interrupts the search form and does not want to continue
  steps:
  - intent: search_place
  - action: action_start_search
  - action: search_form
  - active_loop: search_form
  - intent: stop
  - action: utter_ask_stop_search
  - or:
    - intent: affirm
    - intent: stop
  - action: action_deactivate_loop
  - active_loop: null
  - action: utter_search_stopped
  - action: utter_ask_further_help

- story: the user interrupts the search form but then wants to continue
  steps:
  - intent: search_place
  - action: action_start_search
  - action: search_form
  - active_loop: search_form
  - intent: stop
  - action: utter_ask_stop_search
  - or:
    - intent: deny
    - intent: continue


# --------------------------------------------------------------------------- #
# PROVIDE FURTHER INFORMATION
# --------------------------------------------------------------------------- #

- story: the user provides further information for the active search
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [0]
  - action: search_form
  - active_loop: search_form

- story: the user provides further information but no search is selected
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: []
  - action: utter_no_search_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_show_selected_searches
  - action: utter_ask_what_to_change

- story: the user provides further information but multiple searches are selected
  steps:
  - or:
    - intent: inform_search
    - intent: inform_price_range_any
    - intent: inform_price_range_expensive
    - intent: inform_price_range_moderate
    - intent: inform_price_range_inexpensive
    - intent: inform_quality_any
    - intent: inform_quality_excellent
    - intent: inform_quality_moderate
    - intent: inform_price_range_any+inform_quality_any
    - intent: inform_price_range_any+inform_quality_excellent
    - intent: inform_price_range_any+inform_quality_moderate
    - intent: inform_price_range_expensive+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_any
    - intent: inform_price_range_moderate+inform_quality_excellent
    - intent: inform_price_range_moderate+inform_quality_moderate
    - intent: inform_price_range_inexpensive+inform_quality_any
    - intent: inform_price_range_inexpensive+inform_quality_excellent
    - intent: inform_price_range_inexpensive+inform_quality_moderate
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1, 2]
  - action: utter_multiple_searches_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_show_selected_searches
  - action: utter_ask_what_to_change

# --------------------------------------------------------------------------- #
# PARAMETERS
# --------------------------------------------------------------------------- #

- story: the user asks for the search parameters of the current search
  steps:
  - intent: show_search_parameters
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_show_search_parameters

- story: the user asks for the search parameters but no search is selected
  steps:
  - intent: show_search_parameters
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: []
  - action: utter_no_search_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_show_search_parameters

- story: the user asks for the search parameters but multiple searches are selected
  steps:
  - intent: show_search_parameters
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1, 2]
  - action: utter_multiple_searches_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_show_search_parameters


# --------------------------------------------------------------------------- #
# RESULTS
# --------------------------------------------------------------------------- #

- story: the user asks for the results but no search is selected
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: []
  - action: utter_no_search_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: utter_ask_which_results_to_show_2
  - or:
    - intent: show_search_results
    - intent: select
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: null
  - action: action_show_selected_results

- story: the user asks for the results but multiple searches are selected
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1, 2]
  - action: utter_multiple_searches_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: utter_ask_which_results_to_show_2
  - or:
    - intent: show_search_results
    - intent: select
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: null
  - action: action_show_selected_results

- story: the user asks for the results of the current search
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: null
  - action: action_show_selected_results

- story: the user asks for the results of an interrupted search and they resume it
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: false
  - action: utter_missing_search_parameters
  - intent: affirm
  - action: search_form
  - active_loop: search_form

- story: the user asks for the results of an interrupted search but they do not resume it
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: false
  - action: utter_missing_search_parameters
  - or:
    - intent: deny
    - intent: stop
  - action: utter_ask_further_help

- story: the user asks for the results of the current search but there are no results
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: no_results
  - action: utter_no_results

- story: the user asks for the results of the current search but they provide the invalid indices
  steps:
  - intent: show_search_results
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: wrong_indices
  - action: utter_ask_which_results_to_show_2
  - or:
    - intent: show_search_results
    - intent: select
  - action: action_set_selected_results
  - slot_was_set:
    - selected_results_error: null
  - action: action_show_selected_results

- story: the user is shown some search results, then they select others
  steps:
  - action: action_show_selected_results
  - intent: select
  - action: action_set_selected_results

- story: the user is shown some search results, then they select others
  steps:
  - action: action_search
  - intent: select
  - action: action_set_selected_results

- story: the user is shown some search results, then they select others
  steps:
  - action: action_rank_results
  - intent: select
  - action: action_set_selected_results

# --------------------------------------------------------------------------- #
# RANK RESULTS
# --------------------------------------------------------------------------- #

- story: the user wants to change the order in which the results are ranked
  steps:
  - or:
    - intent: rank_results_by_distance
    - intent: rank_results_by_relevance
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: true
  - action: action_rank_results

- story: | 
    the user wants to change the order in which the results are ranked,
    but the search parameters are not set; they agree to set them
  steps:
  - or:
    - intent: rank_results_by_distance
    - intent: rank_results_by_relevance
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: false
  - action: utter_missing_search_parameters
  - intent: affirm
  - action: search_form
  - active_loop: search_form

- story: | 
    the user wants to change the order in which the results are ranked,
    but the search parameters are not set; they do not agree to set them
  steps:
  - or:
    - intent: rank_results_by_distance
    - intent: rank_results_by_relevance
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1]
  - action: action_check_search_parameters
  - slot_was_set:
    - all_required_parameters_set: false
  - action: utter_missing_search_parameters
  - or:
    - intent: deny
    - intent: stop
  - action: utter_ask_further_help

- story: |
    the user wants to change the order in which the results are ranked, 
    but no search is selected
  steps:
  - or:
    - intent: rank_results_by_distance
    - intent: rank_results_by_relevance
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: []
  - action: utter_no_search_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_rank_results

- story: |
    the user wants to change the order in which the results are ranked, 
    but multiple searches are selected
  steps:
  - or:
    - intent: rank_results_by_distance
    - intent: rank_results_by_relevance
  - action: action_selected_searches_guard
  - slot_was_set:
    - selected_searches: [1, 2]
  - action: utter_multiple_searches_selected
  - action: utter_ask_which_search_to_select
  - or:
    - intent: select_searches
    - intent: select
  - action: action_set_selected_searches
  - slot_was_set:
    - selected_searches_error: null
    - selected_searches: [1]
  - action: action_rank_results